<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
<script>
// 微信红包：每次的金额最小为 0.01，最大为剩余金额 / 剩余数量的 2 倍
// sum 总数，length 个数，isRandom 随机或平均
const wxrp = (sum, length, isRandom = true) => {
    const min = 0.01
    const fix2 = n => (Math.floor(n * 100) / 100).toFixed(2) - 0 // toFixed 四舍可以，五入会超出
    let array = []

    if (sum / length < 0.01) return console.warn(`${sum} 元，分 ${length} 份，每个人一分钱都分不了`)

    if (isRandom) {
        array = [...Array(length - 1)].map((n, i) => {
            const max = sum / (length - i) * 2
            const random = fix2(Math.random() * max)
            const res = Math.max(min, random)
            sum -= res
            return res
        })
        array.push(fix2(sum))
    } else {
        const average = fix2(sum / length)
        array = [...Array(length - 1)].map(() => average)
        const total = array.reduce((a, b) => fix2(a + b), 0)
        array.push(fix2(sum - total))
    }

    console.log(array)
    console.log('总数：' + array.reduce((a, b) => fix2(a + b)))

    return array
}
// wxrp(0.05, 3)
// wxrp(20, 10, false)

// sum 总数，length 个数，min 最大值，max 最小值，digits 小数位数
const random = (sum, length, min, max, digits) => {
    const power = 10 ** digits
    const fix = n => (Math.floor(n * power) / power).toFixed(digits) - 0 // toFixed 四舍可以，五入会超出

    if (sum / length < min) return console.warn(`总数 ${sum}，长度 ${length}，得平均值 ${sum / length}，小于最小值 ${min}`)

    const array = [...Array(length - 1)].map((n, i) => {
        const rmax = sum / (length - i) * 2 // 如何达到 balance ？
        const random = fix(Math.random() * rmax) 
        const res = Math.max(min, Math.min(random, max))
        sum -= res
        return res
    })
    array.push(fix(sum))
    if (fix(sum) < min || fix(sum) > max) console.log(fix(sum))

    // const getRandom = () => {
    //     let num = (Math.random() * (max - min) + min).toFixed(digits) - 0 // 小于 2 倍平均数的随机数
    //     if (num < min || num > max) num = getRandom() // 超过最大或最小值重新计算
    //     return num
    // }
    // while (length > 1) {
    //     let num = getRandom()
    //     array.push(num) // push 随机数
    //     sum -= num // 剩余总和
    //     length-- // 剩余长度
    // }
    // array.push(sum) // push 最后的总和

    console.log(array)
    const total = array.reduce((a, b) => a + b)
    if (total !== 100) console.warn('总数不正确：' + total)

    return array
}

const sum = 100 // 总和
const length = 10 // 数组长度
const min = 1 // 最小值
const max = 20 // 最大值
const digits = 0 // 小数位数
for (let i = 0; i < 100; i++) random(sum, length, min, max, digits)
</script>
</body>
</html>