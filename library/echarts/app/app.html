<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>app用户</title>
		<link rel="shortcut icon" href="../../../img/love.png" />
		<style type="text/css">
			#pro, #city {
				width: 1200px;
				height: 600px;
				margin: 50px 0;
			}
		</style>
	</head>
	<body>
		<div id="pro"></div>
		<div id="city"></div>
		
		<script src="../echarts-4.0.2.js" type="text/javascript" charset="utf-8"></script>
		<script src="../excel.js" type="text/javascript" charset="utf-8"></script>
		<script src="app.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			// 去掉带有省直辖，将英文逗号改成中文逗号
			var proData = []
			var proDataExcel = []
			var cityData = []
			var cityDataExcel = []
			app.split('\n').forEach(function(obj, index){
				var item = obj.split(',')
				var proItem = item[5].replace(/省/, '')
				var cityItem = item[6].replace(/市/, '')
				proItem.indexOf('区') > -1 && (proItem = proItem.slice(0, 2))
				proItem === '内蒙' && (proItem = '内蒙古')
				// 省
				if(proData.indexOf(proItem) < 0){
					proData.push(proItem)
					proDataExcel.push({name:proItem, value:1})
				} else {
					proDataExcel[proData.indexOf(proItem)].value++
				}
				// 市
				var city = /北京|天津|上海|重庆/.test(proItem) ? proItem : item[6]
				if(cityData.indexOf(city) < 0){
					cityData.push(city)
					cityDataExcel.push({name:city,value:1})
				} else {
					cityDataExcel[cityData.indexOf(city)].value++
				}
			})
			proDataExcel.sort(function(a, b){ return b.value - a.value })
			var proName = []
			var cityName = []
			for(var item of proDataExcel) proName.push(item.name)
			for(var item of cityDataExcel) cityName.push(item.name)
			
			// 各省排名柱状图
			echarts.init(document.getElementById('pro')).setOption({
				title: {
					text: '各省人数',
					left: 'center',
					textStyle: { fontSize: 24 }
				},
				tooltip: {
					formatter: res => '排名：' + (res.dataIndex + 1)
				},
				xAxis: {
					data: proName,
					axisTick: { alignWithLabel: true },
					interval: 0
				},
				yAxis: {},
				grid: {
					width: '120%',
					left: '5%'
				},
				series: {
					type: 'bar',
					name: '全国',
					label: { show: true, position: 'top', },
			        itemStyle: { color: '#08f' },
					data: proDataExcel
				}
			})
		</script>
	</body>
</html>
